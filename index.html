<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Tools for Megascope Analysis Within the PelaVerse ‚Ä¢ pelascope</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Tools for Megascope Analysis Within the PelaVerse">
<meta name="description" content="Set of function to facilitate Megascope analysis, from boat campaign to DSM. The user is accompanied from preparation of raw survey data, linearization, segmentation to modelisation process and finally visualization.">
<meta property="og:description" content="Set of function to facilitate Megascope analysis, from boat campaign to DSM. The user is accompanied from preparation of raw survey data, linearization, segmentation to modelisation process and finally visualization.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">pelascope</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/calculation.html">Calculation</a></li>
    <li><a class="dropdown-item" href="articles/effort-preparation.html">Effort preparation</a></li>
    <li><a class="dropdown-item" href="articles/esw-calculation.html">ESW calculation</a></li>
    <li><a class="dropdown-item" href="articles/Processing_climatologies.html">Processing climatologies</a></li>
    <li><a class="dropdown-item" href="articles/sightings-preparation.html">Sightings preparation</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="pelascope">pelascope<a class="anchor" aria-label="anchor" href="#pelascope"></a>
</h1></div>
<!-- badges: start -->
<!-- badges: end -->
<p>This <span class="emoji" data-emoji="package">üì¶</span> includes all the functions needed to analyze distance sampling data. From raw data to distribution mapping and ESW calculation, the pelascope package brings together a set of useful functions for analyzing field data. A description is available on the <a href="https://cheronymo.github.io/pelascope.github.io/index.html" class="external-link">pelascope website</a>.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install pelascope like so:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_gitlab.html" class="external-link">install_gitlab</a></span><span class="op">(</span></span>
<span>  host <span class="op">=</span> <span class="st">"https://gitlab.univ-lr.fr"</span>,</span>
<span>  repo <span class="op">=</span> <span class="st">"pelaverse/pelascope"</span>,</span>
<span>  build_vignettes <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">pelascope</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: remplacement de l'importation pr√©c√©dente 'Distance::create.bins' par</span></span>
<span><span class="co">#&gt; 'mrds::create.bins' lors du chargement de 'pelaCDS'</span></span>
<span><span class="co">#&gt; Warning: remplacement de l'importation pr√©c√©dente 'magrittr::set_names' par</span></span>
<span><span class="co">#&gt; 'purrr::set_names' lors du chargement de 'pelascope'</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attachement du package : 'dplyr'</span></span>
<span><span class="co">#&gt; Les objets suivants sont masqu√©s depuis 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; Les objets suivants sont masqu√©s depuis 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="effort">Effort<a class="anchor" aria-label="anchor" href="#effort"></a>
</h2>
<p>First step: take care of the effort table. The data set (extracted from the database) must be imported, and then they let it go!</p>
<div class="section level3">
<h3 id="import-effort-table">Import effort table<a class="anchor" aria-label="anchor" href="#import-effort-table"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_effort_path</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"pelascope"</span>, <span class="st">"extract_test_effort_BD.csv"</span><span class="op">)</span></span>
<span><span class="va">data_effort_brut</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv2</a></span><span class="op">(</span><span class="va">data_effort_path</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_effort_brut</span><span class="op">)</span></span>
<span><span class="co">#&gt;     gid strateType survey cycle session computer     ship transect</span></span>
<span><span class="co">#&gt; 1 41804    Neritic PELGAS  2023    LEG1        C Thalassa     NULL</span></span>
<span><span class="co">#&gt; 2 41805    Neritic PELGAS  2023    LEG1        C Thalassa     NULL</span></span>
<span><span class="co">#&gt; 3 41806    Neritic PELGAS  2023    LEG1        C Thalassa     NULL</span></span>
<span><span class="co">#&gt; 4 41807    Neritic PELGAS  2023    LEG1        C Thalassa     NULL</span></span>
<span><span class="co">#&gt; 5 41808    Neritic PELGAS  2023    LEG1        C Thalassa     NULL</span></span>
<span><span class="co">#&gt; 6 41809    Neritic PELGAS  2023    LEG1        C Thalassa     NULL</span></span>
<span><span class="co">#&gt;              plateform   routeType status     effortGrp     effortLeg</span></span>
<span><span class="co">#&gt; 1 upper_bridge_outside prospection  BEGIN 30042023_C_G1 30042023_C_L1</span></span>
<span><span class="co">#&gt; 2 upper_bridge_outside prospection    ADD 30042023_C_G1 30042023_C_L2</span></span>
<span><span class="co">#&gt; 3 upper_bridge_outside prospection    END 30042023_C_G1 30042023_C_L1</span></span>
<span><span class="co">#&gt; 4 upper_bridge_outside       other  BEGIN 30042023_C_G2 30042023_C_L1</span></span>
<span><span class="co">#&gt; 5 upper_bridge_outside       other    END 30042023_C_G2 30042023_C_L1</span></span>
<span><span class="co">#&gt; 6 upper_bridge_outside prospection  BEGIN 30042023_C_G3 30042023_C_L1</span></span>
<span><span class="co">#&gt;         date hhmmss1 left right speed courseAvg seaState windDir windForce</span></span>
<span><span class="co">#&gt; 1 30/04/2023   63702 CADE  GAMO    10       248        2     310         6</span></span>
<span><span class="co">#&gt; 2 30/04/2023   70019 CADE  GAMO    11       219        2     310         6</span></span>
<span><span class="co">#&gt; 3 30/04/2023   73055 CADE  GAMO    11       208        2     310         6</span></span>
<span><span class="co">#&gt; 4 30/04/2023   73056 NULL  NULL    11       208        2     310         6</span></span>
<span><span class="co">#&gt; 5 30/04/2023   91018 NULL  NULL    11       208        2     310         6</span></span>
<span><span class="co">#&gt; 6 30/04/2023   91020 GAMO  ELME    10       168        3     295         9</span></span>
<span><span class="co">#&gt;   swellDir swellHgt glareFrom glareTo glareSever cloudCover visibility</span></span>
<span><span class="co">#&gt; 1        0        0         0       0       none          8          2</span></span>
<span><span class="co">#&gt; 2        0        0         0       0       none          8          2</span></span>
<span><span class="co">#&gt; 3        0        0         0       0       none          8          2</span></span>
<span><span class="co">#&gt; 4        0        0         0       0       none          8          2</span></span>
<span><span class="co">#&gt; 5        0        0         0       0       none          8          2</span></span>
<span><span class="co">#&gt; 6      280      1.5         0       0       none          8          2</span></span>
<span><span class="co">#&gt;   subjectMam subjectBir camera          comment nObservers center         lat</span></span>
<span><span class="co">#&gt; 1         MM       NULL    OFF       BROUILLARD          2   NULL    48.34592</span></span>
<span><span class="co">#&gt; 2         MM       NULL    OFF             NULL          2   NULL 48.29903333</span></span>
<span><span class="co">#&gt; 3         MM       NULL    OFF REUNION SECURITE          2   NULL 48.22907033</span></span>
<span><span class="co">#&gt; 4         MM       NULL    OFF REUNION SECURITE          0   NULL   48.229065</span></span>
<span><span class="co">#&gt; 5         MM       NULL    OFF REUNION SECURITE          0   NULL 47.96489167</span></span>
<span><span class="co">#&gt; 6         MM       NULL    OFF             NULL          2   NULL 47.96479833</span></span>
<span><span class="co">#&gt;            lon                                               geom   hhmmss</span></span>
<span><span class="co">#&gt; 1 -4.541956667 0101000020E6100000E7BA3CB0F62A12C02384471B472C4840 06:37:02</span></span>
<span><span class="co">#&gt; 2 -4.620433333 0101000020E6100000470F30E0527B12C04A8A69B946264840 07:00:19</span></span>
<span><span class="co">#&gt; 3 -4.709607167 0101000020E6100000BE5CD742A3D612C03E133B2D521D4840 07:30:55</span></span>
<span><span class="co">#&gt; 4      -4.7096 0101000020E610000066F7E461A1D612C041D47D00521D4840 07:30:56</span></span>
<span><span class="co">#&gt; 5 -4.711337917 0101000020E6100000D6F381F768D812C01A42F49181FB4740 09:10:18</span></span>
<span><span class="co">#&gt; 6 -4.711299639 0101000020E6100000D1BCBAEE5ED812C06F7304837EFB4740 09:10:20</span></span>
<span><span class="co">#&gt;           dateTime         TransectID             LegID</span></span>
<span><span class="co">#&gt; 1 30/04/2019 23:50 TR_Pelgas_30042023 30042023_SEG_2849</span></span>
<span><span class="co">#&gt; 2 30/04/2019 23:50 TR_Pelgas_30042023 30042023_SEG_2849</span></span>
<span><span class="co">#&gt; 3 30/04/2019 23:50 TR_Pelgas_30042023 30042023_SEG_2849</span></span>
<span><span class="co">#&gt; 4 30/04/2019 23:50 TR_Pelgas_30042023 30042023_SEG_2850</span></span>
<span><span class="co">#&gt; 5 30/04/2019 23:50 TR_Pelgas_30042023 30042023_SEG_2850</span></span>
<span><span class="co">#&gt; 6 30/04/2019 23:50 TR_Pelgas_30042023 30042023_SEG_2851</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/plot_subjective.html">plot_subjective</a></span><span class="op">(</span>effort_table_brut <span class="op">=</span> <span class="va">data_effort_brut</span><span class="op">)</span></span>
<span><span class="co">#&gt; $table_subjective</span></span>
<span><span class="co">#&gt; # A tibble: 8 √ó 2</span></span>
<span><span class="co">#&gt; # Groups:   Subjective [8]</span></span>
<span><span class="co">#&gt;   Subjective Count</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;      &lt;int&gt;</span></span>
<span><span class="co">#&gt; 1 EE            22</span></span>
<span><span class="co">#&gt; 2 EG             6</span></span>
<span><span class="co">#&gt; 3 GG           356</span></span>
<span><span class="co">#&gt; 4 GM            98</span></span>
<span><span class="co">#&gt; 5 GP             9</span></span>
<span><span class="co">#&gt; 6 MM           213</span></span>
<span><span class="co">#&gt; 7 MP            66</span></span>
<span><span class="co">#&gt; 8 PP            46</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $figure_subjective</span></span></code></pre></div>
<p><img src="reference/figures/README-plot_sub-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="check-and-transform-effort">Check and transform effort<a class="anchor" aria-label="anchor" href="#check-and-transform-effort"></a>
</h3>
<p>After importing the raw data set from the database, it is necessary to perform some security checks and transform the data set in order to continue the workflow. The ‚Äòcheck_raw_effort‚Äô function allows you to change the names of the columns, create the DateTime column, and select the column you are interested in. The function has 3 arguments :</p>
<ul>
<li><p>data_effort: raw data effort</p></li>
<li><p>only_prospection: TRUE or FALSE, if it‚Äôs needed to keep not only prospection route type</p></li>
<li><p>filter_speed: minimum speed to be keep</p></li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">data_effort_clean</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="reference/check_raw_effort.html">check_raw_effort</a></span><span class="op">(</span>data_effort <span class="op">=</span> <span class="va">data_effort_brut</span>, </span>
<span>                    only_prospection <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                    filter_speed <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ Information regarding the dataset ‚îÄ‚îÄ</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    Route Type Effort Point Count</span></span>
<span><span class="co">#&gt; 1       other                142</span></span>
<span><span class="co">#&gt; 2 prospection                558</span></span>
<span><span class="co">#&gt; 3    trawling                116</span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ Dataset cleaned ‚îÄ‚îÄ</span></span>
<span><span class="co">#&gt; </span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_effort_clean</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Survey            plateform   routeType status         LegID speed Beaufort</span></span>
<span><span class="co">#&gt; 1 PELGAS upper_bridge_outside prospection  BEGIN 30042023_C_G1    10        2</span></span>
<span><span class="co">#&gt; 2 PELGAS upper_bridge_outside prospection    ADD 30042023_C_G1    11        2</span></span>
<span><span class="co">#&gt; 3 PELGAS upper_bridge_outside prospection    END 30042023_C_G1    11        2</span></span>
<span><span class="co">#&gt; 4 PELGAS upper_bridge_outside prospection  BEGIN 30042023_C_G3    10        3</span></span>
<span><span class="co">#&gt; 5 PELGAS upper_bridge_outside prospection    ADD 30042023_C_G3    11        3</span></span>
<span><span class="co">#&gt; 6 PELGAS upper_bridge_outside prospection    ADD 30042023_C_G3    11        3</span></span>
<span><span class="co">#&gt;   Latitude Longitude n_obs            DateTime         TransectID</span></span>
<span><span class="co">#&gt; 1 48.34592 -4.541957     2 2023-04-30 06:37:02 TR_Pelgas_30042023</span></span>
<span><span class="co">#&gt; 2 48.29903 -4.620433     2 2023-04-30 07:00:19 TR_Pelgas_30042023</span></span>
<span><span class="co">#&gt; 3 48.22907 -4.709607     2 2023-04-30 07:30:55 TR_Pelgas_30042023</span></span>
<span><span class="co">#&gt; 4 47.96480 -4.711300     2 2023-04-30 09:10:20 TR_Pelgas_30042023</span></span>
<span><span class="co">#&gt; 5 47.89950 -4.680827     2 2023-04-30 09:34:07 TR_Pelgas_30042023</span></span>
<span><span class="co">#&gt; 6 47.83268 -4.624492     2 2023-04-30 09:59:15 TR_Pelgas_30042023</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="prepare-the-effort-table-for-linearization">Prepare the effort table for linearization<a class="anchor" aria-label="anchor" href="#prepare-the-effort-table-for-linearization"></a>
</h3>
<p>In some cases, the LegID column does not represent a constant environment and may change over time. To resolve this issue, the ‚Äòprep_lin‚Äô function recreates effort points when necessary (with ‚ÄúNEW‚Äù as the status) and adjusts the ‚ÄòLegID‚Äô column to obtain a constant environment during the Leg.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">data_effort_clean</span> <span class="op">&lt;-</span> <span class="fu">pelascope</span><span class="fu">::</span><span class="fu"><a href="reference/prep_lin.html">prep_lin</a></span><span class="op">(</span></span>
<span>  effort_table  <span class="op">=</span> <span class="va">data_effort_clean</span>, </span>
<span>  variable <span class="op">=</span> <span class="fu"><a href="https://rlang.r-lib.org/reference/defusing-advanced.html" class="external-link">quos</a></span><span class="op">(</span><span class="va">Beaufort</span>, <span class="va">plateform</span>, <span class="va">n_obs</span><span class="op">)</span>, </span>
<span>  unique_column <span class="op">=</span> <span class="st">"LegID"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Redefinig LegID columnn according to Beaufort, plateform and n_obs</span></span>
<span>  </span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_effort_clean</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Survey            plateform   routeType status           LegID speed Beaufort</span></span>
<span><span class="co">#&gt; 1 PELGAS upper_bridge_outside prospection  BEGIN 30042023_C_G1_1    10        2</span></span>
<span><span class="co">#&gt; 2 PELGAS upper_bridge_outside prospection    ADD 30042023_C_G1_1    11        2</span></span>
<span><span class="co">#&gt; 3 PELGAS upper_bridge_outside prospection    END 30042023_C_G1_1    11        2</span></span>
<span><span class="co">#&gt; 4 PELGAS upper_bridge_outside prospection  BEGIN 30042023_C_G3_2    10        3</span></span>
<span><span class="co">#&gt; 5 PELGAS upper_bridge_outside prospection    ADD 30042023_C_G3_2    11        3</span></span>
<span><span class="co">#&gt; 6 PELGAS upper_bridge_outside prospection    ADD 30042023_C_G3_2    11        3</span></span>
<span><span class="co">#&gt;   Latitude Longitude n_obs            DateTime         TransectID</span></span>
<span><span class="co">#&gt; 1 48.34592 -4.541957     2 2023-04-30 06:37:02 TR_Pelgas_30042023</span></span>
<span><span class="co">#&gt; 2 48.29903 -4.620433     2 2023-04-30 07:00:19 TR_Pelgas_30042023</span></span>
<span><span class="co">#&gt; 3 48.22907 -4.709607     2 2023-04-30 07:30:55 TR_Pelgas_30042023</span></span>
<span><span class="co">#&gt; 4 47.96480 -4.711300     2 2023-04-30 09:10:20 TR_Pelgas_30042023</span></span>
<span><span class="co">#&gt; 5 47.89950 -4.680827     2 2023-04-30 09:34:07 TR_Pelgas_30042023</span></span>
<span><span class="co">#&gt; 6 47.83268 -4.624492     2 2023-04-30 09:59:15 TR_Pelgas_30042023</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="use-ambidsm-to-linearize-and-segment">Use AmbiDSM to linearize and segment<a class="anchor" aria-label="anchor" href="#use-ambidsm-to-linearize-and-segment"></a>
</h3>
<p>Now that the dataset is clean and in the correct format, it is possible to linearize and segment the effort. The following steps can be performed using the AmniDSM package (<a href="https://gitlab.univ-lr.fr/pelaverse/AMBIdsm" class="external-link uri">https://gitlab.univ-lr.fr/pelaverse/AMBIdsm</a>).</p>
<div class="section level4">
<h4 id="check-visual">Check visual<a class="anchor" aria-label="anchor" href="#check-visual"></a>
</h4>
<p>The check produces a map that initially shows the effort required.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">AMBIdsm</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check using a map</span></span>
<span><span class="va">check</span> <span class="op">&lt;-</span> <span class="va">data_effort_clean</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/AMBIdsm/man/eff_check_leg.html" class="external-link">eff_check_leg</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span><span class="co">#&gt; ‚Üí 18 Legs have only one point</span></span>
<span><span class="va">check</span><span class="op">$</span><span class="va">mapfig</span></span></code></pre></div>
<p><img src="reference/figures/README-AmbiDSM_check-1.png" width="100%"></p>
</div>
<div class="section level4">
<h4 id="check-column">Check column<a class="anchor" aria-label="anchor" href="#check-column"></a>
</h4>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check dataset</span></span>
<span><span class="va">data_effort_clean</span> <span class="op">&lt;-</span> <span class="va">data_effort_clean</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/AMBIdsm/man/eff_check_columns.html" class="external-link">eff_check_columns</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="linearization-of-the-effort">Linearization of the effort<a class="anchor" aria-label="anchor" href="#linearization-of-the-effort"></a>
</h4>
<p>The function has 3 arguments :</p>
<ul>
<li><p>variable_keep: list of variables to be keep after linearisation</p></li>
<li><p>length_min: lenght of minimal linear to be keep, shorter are deleted</p></li>
<li><p>crs</p></li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Linearisation</span></span>
<span><span class="va">data_effort_clean_lin</span> <span class="op">=</span> <span class="va">data_effort_clean</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/AMBIdsm/man/eff_linearize.html" class="external-link">eff_linearize</a></span><span class="op">(</span>variable_keep <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Beaufort"</span>,<span class="st">"TransectID"</span>, <span class="st">"plateform"</span>, <span class="st">"n_obs"</span><span class="op">)</span>, </span>
<span>                length_min <span class="op">=</span> <span class="fl">0.1</span>, </span>
<span>                crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ Linearizing Effort ‚îÄ‚îÄ</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ‚Ñπ 227 breaks have been made within legs for linearization</span></span>
<span><span class="co">#&gt; ‚Ñπ 237 Legs have only one point : they are suppressed</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_effort_clean_lin</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 10 fields</span></span>
<span><span class="co">#&gt; Geometry type: LINESTRING</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -4.677252 ymin: 44.46407 xmax: -1.592198 ymax: 47.97051</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; # A tibble: 6 √ó 11</span></span>
<span><span class="co">#&gt;   Beaufort TransectID         plateform    n_obs    id LegID Start_time         </span></span>
<span><span class="co">#&gt;      &lt;dbl&gt; &lt;chr&gt;              &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;dttm&gt;             </span></span>
<span><span class="co">#&gt; 1        0 TR_Pelgas_25052023 upper_bridg‚Ä¶     2   192 2505‚Ä¶ 2023-05-25 04:57:07</span></span>
<span><span class="co">#&gt; 2        1 TR_Pelgas_04052023 upper_bridg‚Ä¶     2    31 0405‚Ä¶ 2023-05-04 11:42:53</span></span>
<span><span class="co">#&gt; 3        1 TR_Pelgas_05052023 upper_bridg‚Ä¶     2    45 0505‚Ä¶ 2023-05-05 13:56:44</span></span>
<span><span class="co">#&gt; 4        1 TR_Pelgas_05052023 upper_bridg‚Ä¶     2    48 0505‚Ä¶ 2023-05-05 16:09:17</span></span>
<span><span class="co">#&gt; 5        1 TR_Pelgas_18052023 upper_bridg‚Ä¶     2   145 1805‚Ä¶ 2023-05-18 11:33:05</span></span>
<span><span class="co">#&gt; 6        1 TR_Pelgas_22052023 upper_bridg‚Ä¶     2   174 2205‚Ä¶ 2023-05-22 15:03:10</span></span>
<span><span class="co">#&gt; # ‚Ñπ 4 more variables: DateTime &lt;dttm&gt;, End_time &lt;dttm&gt;, Length &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   geometry &lt;LINESTRING [¬∞]&gt;</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="segmentation-of-the-effort">Segmentation of the effort<a class="anchor" aria-label="anchor" href="#segmentation-of-the-effort"></a>
</h4>
<p>Segmentation of the effort. Here to solve a temporary problem, ‚ÄòSegID‚Äô are rendered unique.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Segmentation</span></span>
<span><span class="va">data_effort_clean_Seg</span> <span class="op">&lt;-</span> <span class="va">data_effort_clean_lin</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/AMBIdsm/man/eff_segment.html" class="external-link">eff_segment</a></span><span class="op">(</span>length <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>SegID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">SegID</span>, <span class="st">"_"</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ Segmenting Effort ‚îÄ‚îÄ</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Linking to GEOS 3.12.2, GDAL 3.9.3, PROJ 9.4.1; sf_use_s2() is TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_effort_clean_Seg</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 10 fields</span></span>
<span><span class="co">#&gt; Attribute-geometry relationships: constant (10)</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -4.582032 ymin: 44.46551 xmax: -1.659766 ymax: 47.95554</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; # A tibble: 6 √ó 11</span></span>
<span><span class="co">#&gt;   Beaufort TransectID         plateform          n_obs LegID Start_time         </span></span>
<span><span class="co">#&gt;      &lt;dbl&gt; &lt;chr&gt;              &lt;chr&gt;              &lt;dbl&gt; &lt;chr&gt; &lt;dttm&gt;             </span></span>
<span><span class="co">#&gt; 1        0 TR_Pelgas_25052023 upper_bridge_outs‚Ä¶     2 2505‚Ä¶ 2023-05-25 04:57:07</span></span>
<span><span class="co">#&gt; 2        1 TR_Pelgas_04052023 upper_bridge_outs‚Ä¶     2 0405‚Ä¶ 2023-05-04 11:42:53</span></span>
<span><span class="co">#&gt; 3        1 TR_Pelgas_05052023 upper_bridge_outs‚Ä¶     2 0505‚Ä¶ 2023-05-05 13:56:44</span></span>
<span><span class="co">#&gt; 4        1 TR_Pelgas_05052023 upper_bridge_outs‚Ä¶     2 0505‚Ä¶ 2023-05-05 13:56:44</span></span>
<span><span class="co">#&gt; 5        1 TR_Pelgas_05052023 upper_bridge_outs‚Ä¶     2 0505‚Ä¶ 2023-05-05 13:56:44</span></span>
<span><span class="co">#&gt; 6        1 TR_Pelgas_05052023 upper_bridge_outs‚Ä¶     2 0505‚Ä¶ 2023-05-05 13:56:44</span></span>
<span><span class="co">#&gt; # ‚Ñπ 5 more variables: DateTime &lt;dttm&gt;, End_time &lt;dttm&gt;, SegID &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   Effort &lt;dbl&gt;, geometry &lt;POINT [¬∞]&gt;</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="vizualize-and-save-the-effort-linearized-and-segmented">Vizualize and save the effort linearized and segmented<a class="anchor" aria-label="anchor" href="#vizualize-and-save-the-effort-linearized-and-segmented"></a>
</h3>
<div class="section level4">
<h4 id="save-as-gpkg">Save as GPKG<a class="anchor" aria-label="anchor" href="#save-as-gpkg"></a>
</h4>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Put effort coordinate</span></span>
<span><span class="va">data_effort_sf</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">data_effort_clean</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Longitude_wg84 <span class="op">=</span> <span class="va">Longitude</span>, </span>
<span>                Latitude_wg84 <span class="op">=</span> <span class="va">Latitude</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Longitude"</span>, <span class="st">"Latitude"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write</a></span><span class="op">(</span><span class="va">data_effort_sf</span>, dsn <span class="op">=</span> <span class="st">"./Effort_prepared.gpkg"</span>, layer <span class="op">=</span> <span class="st">"effort"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write</a></span><span class="op">(</span><span class="va">data_effort_clean_lin</span>, dsn <span class="op">=</span> <span class="st">"./Effort_prepared.gpkg"</span>, layer <span class="op">=</span> <span class="st">"effort_linearized"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write</a></span><span class="op">(</span><span class="va">data_effort_clean_Seg</span>, dsn <span class="op">=</span> <span class="st">"./Effort_prepared.gpkg"</span>, layer <span class="op">=</span> <span class="st">"effort_segmented"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="create-vizualisation">Create vizualisation<a class="anchor" aria-label="anchor" href="#create-vizualisation"></a>
</h4>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attachement du package : 'lubridate'</span></span>
<span><span class="co">#&gt; Les objets suivants sont masqu√©s depuis 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     date, intersect, setdiff, union</span></span>
<span></span>
<span><span class="va">plot_effort</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_effort_clean_lin</span>, color <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_effort_clean_Seg</span>, size <span class="op">=</span> <span class="fl">.001</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Effort linearized and segmented"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html" class="external-link">year</a></span><span class="op">(</span><span class="va">DateTime</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">plot_effort</span></span></code></pre></div>
<p><img src="reference/figures/README-vizualize_effort-1.png" width="100%"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="sightings">Sightings<a class="anchor" aria-label="anchor" href="#sightings"></a>
</h2>
<p>This section produces a clean table from sightings data base.</p>
<div class="section level3">
<h3 id="import-sightings">Import Sightings<a class="anchor" aria-label="anchor" href="#import-sightings"></a>
</h3>
<p>Importing the sightings data set from the database.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">data_sight_path</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span>package <span class="op">=</span> <span class="st">"pelascope"</span>, <span class="st">"extract_test_sightings_BD.csv"</span><span class="op">)</span></span>
<span><span class="va">data_sight_brut</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv2</a></span><span class="op">(</span><span class="va">data_sight_path</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_sight_brut</span><span class="op">)</span></span>
<span><span class="co">#&gt;     gid                                               geom region survey cycle</span></span>
<span><span class="co">#&gt; 1 52781 0101000020E61000004A6F6C63D93912C0EB9984F8AD2B4840    NEA PELGAS  2023</span></span>
<span><span class="co">#&gt; 2 52782 0101000020E6100000AF31FB4F114A12C0EDAD22B6CE2A4840    NEA PELGAS  2023</span></span>
<span><span class="co">#&gt; 3 52783 0101000020E610000070198361D34D12C0181853C3912A4840    NEA PELGAS  2023</span></span>
<span><span class="co">#&gt; 4 52784 0101000020E6100000C46BAA015D4E12C04A0C022B872A4840    NEA PELGAS  2023</span></span>
<span><span class="co">#&gt; 5 52786 0101000020E6100000A58FAD543D5612C0924EFE01E9294840    NEA PELGAS  2023</span></span>
<span><span class="co">#&gt; 6 52785 0101000020E6100000F6515927415212C0473D44A33B2A4840    NEA PELGAS  2023</span></span>
<span><span class="co">#&gt;   computer   routeType     effortGrp     effortLeg sighting       date   hhmmss</span></span>
<span><span class="co">#&gt; 1        C prospection 30042023_C_G1 30042023_C_L1   [null] 30/04/2023 06:40:41</span></span>
<span><span class="co">#&gt; 2        C prospection 30042023_C_G1 30042023_C_L1   [null] 30/04/2023 06:44:46</span></span>
<span><span class="co">#&gt; 3        C prospection 30042023_C_G1 30042023_C_L1   [null] 30/04/2023 06:44:47</span></span>
<span><span class="co">#&gt; 4        C prospection 30042023_C_G1 30042023_C_L1   [null] 30/04/2023 06:45:54</span></span>
<span><span class="co">#&gt; 5        C prospection 30042023_C_G1 30042023_C_L1   [null] 30/04/2023 06:47:10</span></span>
<span><span class="co">#&gt; 6        C prospection 30042023_C_G1 30042023_C_L1   [null] 30/04/2023 06:47:00</span></span>
<span><span class="co">#&gt;   species podSize  min  max  age direction  behaviour       behavBird behavMam</span></span>
<span><span class="co">#&gt; 1  PHACAR       1 NULL NULL NULL       180     moving straight_flight     NULL</span></span>
<span><span class="co">#&gt; 2  PHACAR       1 NULL NULL NULL       280     moving straight_flight     NULL</span></span>
<span><span class="co">#&gt; 3    BUOY       1 NULL NULL NULL      NULL       NULL            NULL     NULL</span></span>
<span><span class="co">#&gt; 4  PHACAR       1 NULL NULL NULL       100     moving straight_flight     NULL</span></span>
<span><span class="co">#&gt; 5  LARFUS       2 NULL NULL    A       140     moving straight_flight     NULL</span></span>
<span><span class="co">#&gt; 6  MOTOBO       2 NULL NULL NULL      NULL stationary            NULL     NULL</span></span>
<span><span class="co">#&gt;   behavShip behavGroup                    comment observer side         lat</span></span>
<span><span class="co">#&gt; 1      NULL       NULL                       NULL     CADE    L 48.34124667</span></span>
<span><span class="co">#&gt; 2      NULL       NULL                       NULL     CADE    L 48.33443333</span></span>
<span><span class="co">#&gt; 3      NULL       NULL                       NULL     GAMO    R 48.33257333</span></span>
<span><span class="co">#&gt; 4      NULL       NULL                       NULL     CADE    L    48.33225</span></span>
<span><span class="co">#&gt; 5      NULL       NULL                       NULL     GAMO    R 48.32742333</span></span>
<span><span class="co">#&gt; 6      NULL       NULL BATEAU PLAISANCE A L ANCRE     CADE    L   48.329945</span></span>
<span><span class="co">#&gt;            lon session     ship strateType transect         dateTime</span></span>
<span><span class="co">#&gt; 1 -4.556493333    LEG1 Thalassa    Neritic     NULL 30/04/2023 06:40</span></span>
<span><span class="co">#&gt; 2 -4.572331667    LEG1 Thalassa    Neritic     NULL 30/04/2023 06:44</span></span>
<span><span class="co">#&gt; 3 -4.576001667    LEG1 Thalassa    Neritic     NULL 30/04/2023 06:44</span></span>
<span><span class="co">#&gt; 4 -4.576526667    LEG1 Thalassa    Neritic     NULL 30/04/2023 06:45</span></span>
<span><span class="co">#&gt; 5 -4.584218333    LEG1 Thalassa    Neritic     NULL 30/04/2023 06:47</span></span>
<span><span class="co">#&gt; 6 -4.580326667    LEG1 Thalassa    Neritic     NULL 30/04/2023 06:47</span></span>
<span><span class="co">#&gt;             speciesName         speciesLatin                 unique_id speed</span></span>
<span><span class="co">#&gt; 1        Grand cormoran  Phalacrocorax carbo 8d8f7288-724c-4634-b64654  NULL</span></span>
<span><span class="co">#&gt; 2        Grand cormoran  Phalacrocorax carbo 98ee48bd-9d24-46a9-ad4655  NULL</span></span>
<span><span class="co">#&gt; 3        Bouee de peche Fishing buoy, setnet 782bde92-41ed-4718-8b4656  NULL</span></span>
<span><span class="co">#&gt; 4        Grand cormoran  Phalacrocorax carbo 34f4ad5c-b6b0-464f-954657  NULL</span></span>
<span><span class="co">#&gt; 5          Goeland brun         Larus fuscus 990b93af-8291-49a6-914659  NULL</span></span>
<span><span class="co">#&gt; 6 Bateau a petit moteur     Small motor boat afd412db-1fc1-4419-8b4658  NULL</span></span>
<span><span class="co">#&gt;   distance angle    behavSpecies             LegID         TransectID</span></span>
<span><span class="co">#&gt; 1      150   290 straight_flight 30042023_SEG_2849 TR_Pelgas_30042023</span></span>
<span><span class="co">#&gt; 2      100   280 straight_flight 30042023_SEG_2849 TR_Pelgas_30042023</span></span>
<span><span class="co">#&gt; 3      500    45            NULL 30042023_SEG_2849 TR_Pelgas_30042023</span></span>
<span><span class="co">#&gt; 4       50   300 straight_flight 30042023_SEG_2849 TR_Pelgas_30042023</span></span>
<span><span class="co">#&gt; 5      300    55 straight_flight 30042023_SEG_2849 TR_Pelgas_30042023</span></span>
<span><span class="co">#&gt; 6      300   270            NULL 30042023_SEG_2849 TR_Pelgas_30042023</span></span>
<span><span class="co">#&gt;     routetest</span></span>
<span><span class="co">#&gt; 1 prospection</span></span>
<span><span class="co">#&gt; 2 prospection</span></span>
<span><span class="co">#&gt; 3 prospection</span></span>
<span><span class="co">#&gt; 4 prospection</span></span>
<span><span class="co">#&gt; 5 prospection</span></span>
<span><span class="co">#&gt; 6 prospection</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="clean-sightings">Clean sightings<a class="anchor" aria-label="anchor" href="#clean-sightings"></a>
</h3>
<p>The function ‚Äòcheck_raw_sightings‚Äô produces a clean sighting dataset and give some information. Perpendical distance (PerpDist) is calculated using ‚Äòsinus‚Äô and only appropriate for ship survey.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">data_sightings_clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/check_raw_sightings.html">check_raw_sightings</a></span><span class="op">(</span><span class="va">data_sight_brut</span><span class="op">)</span></span>
<span><span class="co">#&gt; ‚úñ 'direction' column contains 2009 NULL values</span></span>
<span><span class="co">#&gt; ‚úñ 'behaviour' column contains 501 NULL values</span></span>
<span><span class="co">#&gt; ‚úñ 'speciesLatin' column contains 1 NULL values</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">data_sightings_clean</span><span class="op">)</span></span>
<span><span class="co">#&gt;   survey session   routeType         LegID Species         speciesLatin</span></span>
<span><span class="co">#&gt; 1 PELGAS    LEG1 prospection 30042023_C_G1  PHACAR  Phalacrocorax carbo</span></span>
<span><span class="co">#&gt; 2 PELGAS    LEG1 prospection 30042023_C_G1  PHACAR  Phalacrocorax carbo</span></span>
<span><span class="co">#&gt; 3 PELGAS    LEG1 prospection 30042023_C_G1    BUOY Fishing buoy, setnet</span></span>
<span><span class="co">#&gt; 4 PELGAS    LEG1 prospection 30042023_C_G1  PHACAR  Phalacrocorax carbo</span></span>
<span><span class="co">#&gt; 5 PELGAS    LEG1 prospection 30042023_C_G1  LARFUS         Larus fuscus</span></span>
<span><span class="co">#&gt; 6 PELGAS    LEG1 prospection 30042023_C_G1  MOTOBO     Small motor boat</span></span>
<span><span class="co">#&gt;   GroupSize  behaviour  Side Longitude Latitude            DateTime distance</span></span>
<span><span class="co">#&gt; 1         1     moving  left -4.556493 48.34125 2023-04-30 06:40:41      150</span></span>
<span><span class="co">#&gt; 2         1     moving  left -4.572332 48.33443 2023-04-30 06:44:46      100</span></span>
<span><span class="co">#&gt; 3         1       NULL right -4.576002 48.33257 2023-04-30 06:44:47      500</span></span>
<span><span class="co">#&gt; 4         1     moving  left -4.576527 48.33225 2023-04-30 06:45:54       50</span></span>
<span><span class="co">#&gt; 5         2     moving right -4.584218 48.32742 2023-04-30 06:47:10      300</span></span>
<span><span class="co">#&gt; 6         2 stationary  left -4.580327 48.32995 2023-04-30 06:47:00      300</span></span>
<span><span class="co">#&gt;   angle  PerpDist direction         TransectID</span></span>
<span><span class="co">#&gt; 1   290 140.95389       180 TR_Pelgas_30042023</span></span>
<span><span class="co">#&gt; 2   280  98.48078       280 TR_Pelgas_30042023</span></span>
<span><span class="co">#&gt; 3    45 353.55339        NA TR_Pelgas_30042023</span></span>
<span><span class="co">#&gt; 4   300  43.30127       100 TR_Pelgas_30042023</span></span>
<span><span class="co">#&gt; 5    55 245.74561       140 TR_Pelgas_30042023</span></span>
<span><span class="co">#&gt; 6   270 300.00000        NA TR_Pelgas_30042023</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="check-sightings-with-ambidsm">Check sightings with AmbiDSM<a class="anchor" aria-label="anchor" href="#check-sightings-with-ambidsm"></a>
</h3>
<p>AmbiDSM provides access to another verification that allows you to obtain up-to-date information. It produces DupID columns: potential duplicates that can be explored.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">AMBIdsm</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check columns</span></span>
<span><span class="va">data_sightings_clean</span> <span class="op">&lt;-</span> <span class="va">data_sightings_clean</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/AMBIdsm/man/sight_check_columns.html" class="external-link">sight_check_columns</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; PHACAR   BUOY LARFUS MOTOBO SULBAS SAILBO LARGUL PHAARI LARMAR PHASPP SMASHE </span></span>
<span><span class="co">#&gt;      6    126    332     30    694     81    246     31     41      1     15 </span></span>
<span><span class="co">#&gt; URIAAL  POTBO ALCURI PUFPUF DELDEL RISTRI LARARG ALCTOR RESEBO FRAARC TRAWLB </span></span>
<span><span class="co">#&gt;     41      1      6    183    398     32    104      3      1      2     59 </span></span>
<span><span class="co">#&gt; PLASTR ALCSPP FISHTR POLYTR CATSKU  TRASH  NETBO MOLMOL GLOMEL WOODTR STEDEL </span></span>
<span><span class="co">#&gt;    246      1     24      5     12     22     27     67      5     26     20 </span></span>
<span><span class="co">#&gt; COLSPP PASSER DEADBI AREINT PHYCOL LARMIC DELSPP REGIGN LIMICO CONTBO ZIPSPP </span></span>
<span><span class="co">#&gt;      2     14      3      4      3     56     13      1      3      4      1 </span></span>
<span><span class="co">#&gt; HIRRUS LARSPP FULGLA GREGUL APUAPU BALSPP ASIFLA FALSPP COLPAL LARMEL CORCOR </span></span>
<span><span class="co">#&gt;     20      2    149     28      7      1      1      2      2      3      1 </span></span>
<span><span class="co">#&gt; CHLNIG STEHIR STRDEC  PLANE BLAGUL LARFIS METATR FISHBO TURTRU PRIGLA PANHAL </span></span>
<span><span class="co">#&gt;      4     41     26      4      2      8      5     13      8      3      1 </span></span>
<span><span class="co">#&gt; PASSBO  SHARK THUTHY HIRSPP STESPP GRAGRI PLALEU STECOE STESAN TANKER STEPAR </span></span>
<span><span class="co">#&gt;     19      3      1      5      8      3      1      3     51     12      2 </span></span>
<span><span class="co">#&gt; PUFGRI MEDCET PUFMAU CARGOB STRTUR  JELLY LARRID BULKBO STEPOM MELNIG STERCO </span></span>
<span><span class="co">#&gt;      4      1     45      3      6      1      2      4      1      1      2 </span></span>
<span><span class="co">#&gt; PUFSPP OCESPP NUMSPP CHAHIA MUSSTR CALSPP LONGBO MEDTER   BOAT FERRYB COLLIV </span></span>
<span><span class="co">#&gt;      2      9      2      2      1      4      2      1      1      3      3 </span></span>
<span><span class="co">#&gt; HYDPEL LARMIN PHYSPP NUMPHA DELURB PHYTRO CALALP ACRSCI CALFER FALTIN LARCAN </span></span>
<span><span class="co">#&gt;      2      1      1      1      1      1      2      1      1      1      1 </span></span>
<span><span class="co">#&gt; RIPRIP BUBIBI </span></span>
<span><span class="co">#&gt;      1      1</span></span>
<span><span class="co">#&gt; ‚Ñπ 16 detections seem to correspond to several observations: you can identify them with the column DupID</span></span>
<span><span class="co">#&gt; ‚úñ There are mutliple observations of the same species in one detection</span></span>
<span><span class="co">#&gt; ‚úñ 7 observations have been grouped with others</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="associate-effort-information-to-sightings">Associate Effort information to sightings<a class="anchor" aria-label="anchor" href="#associate-effort-information-to-sightings"></a>
</h2>
<p>AmbiDSM has a function that allows you to check which effort data segments correspond to the TransectID, date and time of each observation. It then links each observation to the nearest segment and adds variables describing the observation conditions to the observation data. The function has several argument :</p>
<ul>
<li><p>data_sightings</p></li>
<li><p>data effort segmented</p></li>
<li><p>crs</p></li>
<li><p>variable_join: variable need to be add in the sightings table</p></li>
<li><p>tol: distance tolerate to be within the segment</p></li>
<li><p>return: can be set on ‚Äòsight‚Äô to get the sightings table or ‚Äòremoved‚Äô to look at potential errors.</p></li>
<li><p>remove_dublicate: TRUE or FALSE</p></li>
</ul>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">AMBIdsm</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Sigthings_with_SegID</span> <span class="op">&lt;-</span> <span class="va">data_sightings_clean</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># data sightings clean</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/AMBIdsm/man/sight_bindSegID.html" class="external-link">sight_bindSegID</a></span><span class="op">(</span><span class="va">data_effort_clean_Seg</span> , <span class="co"># effort segmented</span></span>
<span>                  crs <span class="op">=</span> <span class="fl">4326</span>, </span>
<span>                  variable_join <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Effort'</span>, <span class="st">'Beaufort'</span><span class="op">)</span>,</span>
<span>                  tol <span class="op">=</span> <span class="fl">50</span>, </span>
<span>                  return <span class="op">=</span> <span class="st">"sight"</span>,</span>
<span>                  remove_dup <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; ‚úñ 644 sightings removed because observation time not within start/end of effort transects</span></span>
<span><span class="co">#&gt; ‚úñ 3 sightings duplicated (NOT REMOVED)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">Sigthings_with_SegID</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 √ó 25</span></span>
<span><span class="co">#&gt;   survey session routeType  LegID Species speciesLatin GroupSize behaviour Side </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;      &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;            &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 PELGAS LEG1    prospecti‚Ä¶ 3004‚Ä¶ PHACAR  Phalacrocor‚Ä¶         1 moving    left </span></span>
<span><span class="co">#&gt; 2 PELGAS LEG1    prospecti‚Ä¶ 3004‚Ä¶ PHACAR  Phalacrocor‚Ä¶         1 moving    left </span></span>
<span><span class="co">#&gt; 3 PELGAS LEG1    prospecti‚Ä¶ 3004‚Ä¶ BUOY    Fishing buo‚Ä¶         1 NULL      right</span></span>
<span><span class="co">#&gt; 4 PELGAS LEG1    prospecti‚Ä¶ 3004‚Ä¶ PHACAR  Phalacrocor‚Ä¶         1 moving    left </span></span>
<span><span class="co">#&gt; 5 PELGAS LEG1    prospecti‚Ä¶ 3004‚Ä¶ MOTOBO  Small motor‚Ä¶         2 stationa‚Ä¶ left </span></span>
<span><span class="co">#&gt; 6 PELGAS LEG1    prospecti‚Ä¶ 3004‚Ä¶ LARFUS  Larus fuscus         2 moving    right</span></span>
<span><span class="co">#&gt; # ‚Ñπ 16 more variables: Longitude &lt;dbl&gt;, Latitude &lt;dbl&gt;, DateTime &lt;dttm&gt;,</span></span>
<span><span class="co">#&gt; #   distance &lt;int&gt;, angle &lt;int&gt;, PerpDist &lt;dbl&gt;, direction &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   TransectID &lt;chr&gt;, DupID &lt;int&gt;, Date &lt;date&gt;, Effort &lt;dbl&gt;, Beaufort &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   Start_time &lt;dttm&gt;, End_time &lt;dttm&gt;, SegID &lt;chr&gt;, geomeff &lt;POINT [¬∞]&gt;</span></span></code></pre></div>
<p>Sightings removed because observation time not within start/end of effort transects, are sightings out of effort (other, trawling) or observed under the speed set at the beginning. But it can be check with the variable ‚Äòreturn = ‚Äúremoved‚Äù‚Äô.</p>
</div>
<div class="section level2">
<h2 id="remove-attraction-behaviour">Remove attraction behaviour<a class="anchor" aria-label="anchor" href="#remove-attraction-behaviour"></a>
</h2>
<p>This step allows to remove sightings with attraction behaviour. It produces a table couting the number of observation and a sightings table without attractors.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">Sigthings_without_attractor</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/remove_attractor.html">remove_attractor</a></span><span class="op">(</span><span class="va">Sigthings_with_SegID</span><span class="op">)</span></span>
<span><span class="co">#&gt; ‚Üí 637 attraction behaviour have been removed from the sighting table.</span></span>
<span></span>
<span><span class="va">Sigthings_without_attractor</span><span class="op">$</span><span class="va">table_behavior</span></span>
<span><span class="co">#&gt; # A tibble: 35 √ó 3</span></span>
<span><span class="co">#&gt; # Groups:   Species, behaviour [35]</span></span>
<span><span class="co">#&gt;    Species behaviour      n</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;   &lt;chr&gt;      &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1 DELDEL  attraction   253</span></span>
<span><span class="co">#&gt;  2 LARFUS  attraction   101</span></span>
<span><span class="co">#&gt;  3 SULBAS  attraction    72</span></span>
<span><span class="co">#&gt;  4 LARGUL  attraction    63</span></span>
<span><span class="co">#&gt;  5 FULGLA  attraction    28</span></span>
<span><span class="co">#&gt;  6 LARMIC  attraction    18</span></span>
<span><span class="co">#&gt;  7 LARARG  attraction    15</span></span>
<span><span class="co">#&gt;  8 STRDEC  attraction    14</span></span>
<span><span class="co">#&gt;  9 GREGUL  attraction     9</span></span>
<span><span class="co">#&gt; 10 HIRRUS  attraction     9</span></span>
<span><span class="co">#&gt; # ‚Ñπ 25 more rows</span></span>
<span><span class="va">Sigthings_without_attractor</span><span class="op">$</span><span class="va">table_direction</span></span>
<span><span class="co">#&gt; # A tibble: 22 √ó 3</span></span>
<span><span class="co">#&gt; # Groups:   Species, direction [22]</span></span>
<span><span class="co">#&gt;    Species direction     n</span></span>
<span><span class="co">#&gt;    &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;</span></span>
<span><span class="co">#&gt;  1 PUFPUF        360    11</span></span>
<span><span class="co">#&gt;  2 SULBAS        360     8</span></span>
<span><span class="co">#&gt;  3 FULGLA        360     5</span></span>
<span><span class="co">#&gt;  4 LARARG        360     5</span></span>
<span><span class="co">#&gt;  5 LARGUL        360     3</span></span>
<span><span class="co">#&gt;  6 SAILBO        360     3</span></span>
<span><span class="co">#&gt;  7 DELDEL        360     2</span></span>
<span><span class="co">#&gt;  8 MOLMOL        360     2</span></span>
<span><span class="co">#&gt;  9 RISTRI        360     2</span></span>
<span><span class="co">#&gt; 10 STEHIR        360     2</span></span>
<span><span class="co">#&gt; # ‚Ñπ 12 more rows</span></span>
<span><span class="va">Sigthings_without_attractor</span><span class="op">$</span><span class="va">sightings_table</span></span>
<span><span class="co">#&gt; # A tibble: 2,265 √ó 25</span></span>
<span><span class="co">#&gt;    survey session routeType LegID Species speciesLatin GroupSize behaviour Side </span></span>
<span><span class="co">#&gt;    &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;            &lt;int&gt; &lt;chr&gt;     &lt;chr&gt;</span></span>
<span><span class="co">#&gt;  1 PELGAS LEG1    prospect‚Ä¶ 3004‚Ä¶ PHACAR  Phalacrocor‚Ä¶         1 moving    left </span></span>
<span><span class="co">#&gt;  2 PELGAS LEG1    prospect‚Ä¶ 3004‚Ä¶ PHACAR  Phalacrocor‚Ä¶         1 moving    left </span></span>
<span><span class="co">#&gt;  3 PELGAS LEG1    prospect‚Ä¶ 3004‚Ä¶ BUOY    Fishing buo‚Ä¶         1 NULL      right</span></span>
<span><span class="co">#&gt;  4 PELGAS LEG1    prospect‚Ä¶ 3004‚Ä¶ PHACAR  Phalacrocor‚Ä¶         1 moving    left </span></span>
<span><span class="co">#&gt;  5 PELGAS LEG1    prospect‚Ä¶ 3004‚Ä¶ MOTOBO  Small motor‚Ä¶         2 stationa‚Ä¶ left </span></span>
<span><span class="co">#&gt;  6 PELGAS LEG1    prospect‚Ä¶ 3004‚Ä¶ LARFUS  Larus fuscus         2 moving    right</span></span>
<span><span class="co">#&gt;  7 PELGAS LEG1    prospect‚Ä¶ 3004‚Ä¶ MOTOBO  Small motor‚Ä¶         1 moving    right</span></span>
<span><span class="co">#&gt;  8 PELGAS LEG1    prospect‚Ä¶ 3004‚Ä¶ SULBAS  Morus bassa‚Ä¶         1 moving    left </span></span>
<span><span class="co">#&gt;  9 PELGAS LEG1    prospect‚Ä¶ 3004‚Ä¶ BUOY    Fishing buo‚Ä¶         2 NULL      left </span></span>
<span><span class="co">#&gt; 10 PELGAS LEG1    prospect‚Ä¶ 3004‚Ä¶ SAILBO  Sailing boat         1 moving    right</span></span>
<span><span class="co">#&gt; # ‚Ñπ 2,255 more rows</span></span>
<span><span class="co">#&gt; # ‚Ñπ 16 more variables: Longitude &lt;dbl&gt;, Latitude &lt;dbl&gt;, DateTime &lt;dttm&gt;,</span></span>
<span><span class="co">#&gt; #   distance &lt;int&gt;, angle &lt;int&gt;, PerpDist &lt;dbl&gt;, direction &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   TransectID &lt;chr&gt;, DupID &lt;int&gt;, Date &lt;date&gt;, Effort &lt;dbl&gt;, Beaufort &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   Start_time &lt;dttm&gt;, End_time &lt;dttm&gt;, SegID &lt;chr&gt;, geomeff &lt;POINT [¬∞]&gt;</span></span>
<span></span>
<span><span class="va">Sigthings_with_SegID</span> <span class="op">&lt;-</span> <span class="va">Sigthings_without_attractor</span><span class="op">$</span><span class="va">sightings_table</span></span></code></pre></div>
<p>It‚Äôs possible to save the new layers in the GPKG :</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write</a></span><span class="op">(</span><span class="va">Sigthings_with_SegID</span>, dsn <span class="op">=</span> <span class="st">"./Effort_prepared.gpkg"</span>, layer <span class="op">=</span> <span class="st">"Sigthings_with_SegID"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="associate-number-of-sightings-to-effort">Associate number of sightings to effort<a class="anchor" aria-label="anchor" href="#associate-number-of-sightings-to-effort"></a>
</h2>
<p>Then to prepare the effort, it is needed to tally the number of observation per species in each segment (SegID). The function ‚Äòsightings_to_effort‚Äô produces ‚Äòdet‚Äô for the number of detection and ‚Äòind‚Äô for the number of observation.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">Effort_withSighting</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="reference/sightings_to_effort.html">sightings_to_effort</a></span><span class="op">(</span>effort_segmented <span class="op">=</span> <span class="va">data_effort_clean_Seg</span>,</span>
<span>                      sightings_with_SegID <span class="op">=</span> <span class="va">Sigthings_with_SegID</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">Effort_withSighting</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 192 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -4.582032 ymin: 44.46551 xmax: -1.659766 ymax: 47.95554</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; # A tibble: 6 √ó 193</span></span>
<span><span class="co">#&gt;   Beaufort TransectID         plateform          n_obs LegID Start_time         </span></span>
<span><span class="co">#&gt;      &lt;dbl&gt; &lt;chr&gt;              &lt;chr&gt;              &lt;dbl&gt; &lt;chr&gt; &lt;dttm&gt;             </span></span>
<span><span class="co">#&gt; 1        0 TR_Pelgas_25052023 upper_bridge_outs‚Ä¶     2 2505‚Ä¶ 2023-05-25 04:57:07</span></span>
<span><span class="co">#&gt; 2        1 TR_Pelgas_04052023 upper_bridge_outs‚Ä¶     2 0405‚Ä¶ 2023-05-04 11:42:53</span></span>
<span><span class="co">#&gt; 3        1 TR_Pelgas_05052023 upper_bridge_outs‚Ä¶     2 0505‚Ä¶ 2023-05-05 13:56:44</span></span>
<span><span class="co">#&gt; 4        1 TR_Pelgas_05052023 upper_bridge_outs‚Ä¶     2 0505‚Ä¶ 2023-05-05 13:56:44</span></span>
<span><span class="co">#&gt; 5        1 TR_Pelgas_05052023 upper_bridge_outs‚Ä¶     2 0505‚Ä¶ 2023-05-05 13:56:44</span></span>
<span><span class="co">#&gt; 6        1 TR_Pelgas_05052023 upper_bridge_outs‚Ä¶     2 0505‚Ä¶ 2023-05-05 13:56:44</span></span>
<span><span class="co">#&gt; # ‚Ñπ 187 more variables: DateTime &lt;dttm&gt;, End_time &lt;dttm&gt;, SegID &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   Effort &lt;dbl&gt;, geometry &lt;POINT [¬∞]&gt;, det.PHACAR &lt;int&gt;, ind.PHACAR &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   det.BUOY &lt;int&gt;, ind.BUOY &lt;int&gt;, det.MOTOBO &lt;int&gt;, ind.MOTOBO &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   det.LARFUS &lt;int&gt;, ind.LARFUS &lt;int&gt;, det.SULBAS &lt;int&gt;, ind.SULBAS &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   det.SAILBO &lt;int&gt;, ind.SAILBO &lt;int&gt;, det.LARGUL &lt;int&gt;, ind.LARGUL &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   det.PHAARI &lt;int&gt;, ind.PHAARI &lt;int&gt;, det.LARMAR &lt;int&gt;, ind.LARMAR &lt;int&gt;,</span></span>
<span><span class="co">#&gt; #   det.PHASPP &lt;int&gt;, ind.PHASPP &lt;int&gt;, det.SMASHE &lt;int&gt;, ind.SMASHE &lt;int&gt;, ‚Ä¶</span></span></code></pre></div>
<p>It‚Äôs possible to save the new layers in the GPKG :</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write</a></span><span class="op">(</span><span class="va">Effort_withSighting</span>, dsn <span class="op">=</span> <span class="st">"./Effort_prepared.gpkg"</span>, layer <span class="op">=</span> <span class="st">"Effort_withSighting"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="descriptive-statistics">Descriptive statistics<a class="anchor" aria-label="anchor" href="#descriptive-statistics"></a>
</h2>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">descriptive_stats</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/descriptive_stats_effort.html">descriptive_stats_effort</a></span><span class="op">(</span></span>
<span>  data_effort <span class="op">=</span> <span class="va">Effort_withSighting</span>, </span>
<span>  species_blocking <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DELDEL"</span>, <span class="st">"FULGLA"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ Effort per obs is calculating ‚îÄ‚îÄ</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ Effort per obs is calculating for ind.DELDEL ‚îÄ‚îÄ</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ Effort per obs is calculating for ind.FULGLA ‚îÄ‚îÄ</span></span>
<span><span class="co">#&gt; </span></span>
<span></span>
<span><span class="va">descriptive_stats</span><span class="op">$</span><span class="va">distance_effort</span></span>
<span><span class="co">#&gt; [1] 3988.769</span></span>
<span></span>
<span><span class="va">descriptive_stats</span><span class="op">$</span><span class="va">distance_travel_table</span></span>
<span><span class="co">#&gt; # A tibble: 11 √ó 4</span></span>
<span><span class="co">#&gt; # Groups:   Beaufort, n_obs [7]</span></span>
<span><span class="co">#&gt;    Beaufort n_obs plateform            `Km Effort`</span></span>
<span><span class="co">#&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                      &lt;dbl&gt;</span></span>
<span><span class="co">#&gt;  1        0     2 upper_bridge_outside      14.6  </span></span>
<span><span class="co">#&gt;  2        1     2 upper_bridge_outside      71.7  </span></span>
<span><span class="co">#&gt;  3        2     2 bridge_inside              2.66 </span></span>
<span><span class="co">#&gt;  4        2     2 upper_bridge_outside     538.   </span></span>
<span><span class="co">#&gt;  5        3     2 upper_bridge_outside    1486.   </span></span>
<span><span class="co">#&gt;  6        4     2 bridge_inside             68.8  </span></span>
<span><span class="co">#&gt;  7        4     2 upper_bridge_outside    1249.   </span></span>
<span><span class="co">#&gt;  8        5     2 bridge_inside            127.   </span></span>
<span><span class="co">#&gt;  9        5     2 upper_bridge_outside     368.   </span></span>
<span><span class="co">#&gt; 10        6     2 bridge_inside             61.9  </span></span>
<span><span class="co">#&gt; 11        6     2 upper_bridge_outside       0.700</span></span>
<span></span>
<span><span class="va">descriptive_stats</span><span class="op">$</span><span class="va">stack_bar</span></span></code></pre></div>
<p><img src="reference/figures/README-descriptive_statistics-1.png" width="100%"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">descriptive_stats</span><span class="op">$</span><span class="va">map_beaufort</span></span></code></pre></div>
<p><img src="reference/figures/README-descriptive_statistics-2.png" width="100%"></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">descriptive_stats</span><span class="op">$</span><span class="va">count_ind</span><span class="op">)</span></span>
<span><span class="co">#&gt;      Species n_ind</span></span>
<span><span class="co">#&gt; 1 ind.SULBAS  1607</span></span>
<span><span class="co">#&gt; 2 ind.LARGUL  1049</span></span>
<span><span class="co">#&gt; 3 ind.LARFUS   400</span></span>
<span><span class="co">#&gt; 4 ind.DELDEL   371</span></span>
<span><span class="co">#&gt; 5 ind.PUFPUF   333</span></span>
<span><span class="co">#&gt; 6 ind.PLASTR   218</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">descriptive_stats</span><span class="op">$</span><span class="va">count_det</span><span class="op">)</span></span>
<span><span class="co">#&gt;      Species n_detection</span></span>
<span><span class="co">#&gt; 1 det.SULBAS         508</span></span>
<span><span class="co">#&gt; 2 det.PLASTR         204</span></span>
<span><span class="co">#&gt; 3 det.LARFUS         192</span></span>
<span><span class="co">#&gt; 4 det.PUFPUF         157</span></span>
<span><span class="co">#&gt; 5 det.LARGUL         140</span></span>
<span><span class="co">#&gt; 6 det.FULGLA          99</span></span>
<span></span>
<span><span class="va">descriptive_stats</span><span class="op">$</span><span class="va">plot_general_blocking</span></span></code></pre></div>
<p><img src="reference/figures/README-descriptive_statistics-3.png" width="100%"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">descriptive_stats</span><span class="op">$</span><span class="va">gpkg_general_blocking</span></span>
<span><span class="co">#&gt; Simple feature collection with 2091 features and 1 field</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -6 ymin: 44 xmax: -1 ymax: 48</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; First 10 features:</span></span>
<span><span class="co">#&gt;    Mean_value        geometry</span></span>
<span><span class="co">#&gt; 1          NA   POINT (-6 44)</span></span>
<span><span class="co">#&gt; 2          NA POINT (-5.9 44)</span></span>
<span><span class="co">#&gt; 3          NA POINT (-5.8 44)</span></span>
<span><span class="co">#&gt; 4          NA POINT (-5.7 44)</span></span>
<span><span class="co">#&gt; 5          NA POINT (-5.6 44)</span></span>
<span><span class="co">#&gt; 6          NA POINT (-5.5 44)</span></span>
<span><span class="co">#&gt; 7          NA POINT (-5.4 44)</span></span>
<span><span class="co">#&gt; 8          NA POINT (-5.3 44)</span></span>
<span><span class="co">#&gt; 9          NA POINT (-5.2 44)</span></span>
<span><span class="co">#&gt; 10         NA POINT (-5.1 44)</span></span>
<span></span>
<span><span class="va">descriptive_stats</span><span class="op">$</span><span class="va">blocking_per_species</span></span>
<span><span class="co">#&gt; $ind.DELDEL</span></span>
<span><span class="co">#&gt; $ind.DELDEL$data</span></span>
<span><span class="co">#&gt; Simple feature collection with 2091 features and 1 field</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -6 ymin: 44 xmax: -1 ymax: 48</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; First 10 features:</span></span>
<span><span class="co">#&gt;    Mean_value        geometry</span></span>
<span><span class="co">#&gt; 1          NA   POINT (-6 44)</span></span>
<span><span class="co">#&gt; 2          NA POINT (-5.9 44)</span></span>
<span><span class="co">#&gt; 3          NA POINT (-5.8 44)</span></span>
<span><span class="co">#&gt; 4          NA POINT (-5.7 44)</span></span>
<span><span class="co">#&gt; 5          NA POINT (-5.6 44)</span></span>
<span><span class="co">#&gt; 6          NA POINT (-5.5 44)</span></span>
<span><span class="co">#&gt; 7          NA POINT (-5.4 44)</span></span>
<span><span class="co">#&gt; 8          NA POINT (-5.3 44)</span></span>
<span><span class="co">#&gt; 9          NA POINT (-5.2 44)</span></span>
<span><span class="co">#&gt; 10         NA POINT (-5.1 44)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $ind.DELDEL$map</span></span></code></pre></div>
<p><img src="reference/figures/README-descriptive_statistics-4.png" width="100%"></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a><span class="co">#&gt; $ind.FULGLA</span></span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a><span class="co">#&gt; $ind.FULGLA$data</span></span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 2091 features and 1 field</span></span>
<span id="cb25-6"><a href="#cb25-6" tabindex="-1"></a><span class="co">#&gt; Geometry type: POINT</span></span>
<span id="cb25-7"><a href="#cb25-7" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb25-8"><a href="#cb25-8" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -6 ymin: 44 xmax: -1 ymax: 48</span></span>
<span id="cb25-9"><a href="#cb25-9" tabindex="-1"></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb25-10"><a href="#cb25-10" tabindex="-1"></a><span class="co">#&gt; First 10 features:</span></span>
<span id="cb25-11"><a href="#cb25-11" tabindex="-1"></a><span class="co">#&gt;    Mean_value        geometry</span></span>
<span id="cb25-12"><a href="#cb25-12" tabindex="-1"></a><span class="co">#&gt; 1          NA   POINT (-6 44)</span></span>
<span id="cb25-13"><a href="#cb25-13" tabindex="-1"></a><span class="co">#&gt; 2          NA POINT (-5.9 44)</span></span>
<span id="cb25-14"><a href="#cb25-14" tabindex="-1"></a><span class="co">#&gt; 3          NA POINT (-5.8 44)</span></span>
<span id="cb25-15"><a href="#cb25-15" tabindex="-1"></a><span class="co">#&gt; 4          NA POINT (-5.7 44)</span></span>
<span id="cb25-16"><a href="#cb25-16" tabindex="-1"></a><span class="co">#&gt; 5          NA POINT (-5.6 44)</span></span>
<span id="cb25-17"><a href="#cb25-17" tabindex="-1"></a><span class="co">#&gt; 6          NA POINT (-5.5 44)</span></span>
<span id="cb25-18"><a href="#cb25-18" tabindex="-1"></a><span class="co">#&gt; 7          NA POINT (-5.4 44)</span></span>
<span id="cb25-19"><a href="#cb25-19" tabindex="-1"></a><span class="co">#&gt; 8          NA POINT (-5.3 44)</span></span>
<span id="cb25-20"><a href="#cb25-20" tabindex="-1"></a><span class="co">#&gt; 9          NA POINT (-5.2 44)</span></span>
<span id="cb25-21"><a href="#cb25-21" tabindex="-1"></a><span class="co">#&gt; 10         NA POINT (-5.1 44)</span></span>
<span id="cb25-22"><a href="#cb25-22" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb25-23"><a href="#cb25-23" tabindex="-1"></a><span class="co">#&gt; $ind.FULGLA$map</span></span></code></pre></div>
<p><img src="reference/figures/README-descriptive_statistics-5.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="estimate-esw">Estimate ESW<a class="anchor" aria-label="anchor" href="#estimate-esw"></a>
</h2>
<p>Now it‚Äôs time to estimate ESW with the function ‚Äòestimate_esw‚Äô. From the table sighting with the SegID column and the effort table just created, it‚Äôs possible to estimate the Effective Strip Width. Species has to be selected and the variable to be considered. The function produces the effort table with ESW value, a table with ESW values calculated, a graph and model selection with abundance estimated. Estimation of ESW is based on half-normal detection function.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">export_esw</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="reference/estimate_esw.html">estimate_esw</a></span><span class="op">(</span>data_sight <span class="op">=</span> <span class="va">Sigthings_with_SegID</span>, </span>
<span>               data_effort <span class="op">=</span> <span class="va">Effort_withSighting</span>, </span>
<span>               species <span class="op">=</span> <span class="st">"FULGLA"</span>, </span>
<span>               variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Beaufort"</span>, <span class="st">"plateform"</span><span class="op">)</span>, </span>
<span>               var_factor <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Calling Distance package, for more information visit:</span></span>
<span><span class="co">#&gt; &lt;https://www.st-andrews.ac.uk/mathematics-statistics/research/impact/distance/&gt;.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ Data cleaning ‚îÄ‚îÄ</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; There are 99 sightings in the dataset selected.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ Model selection ‚îÄ‚îÄ</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fitting half-normal key function</span></span>
<span><span class="co">#&gt; AIC= -99.781</span></span>
<span><span class="co">#&gt; Fitting half-normal key function</span></span>
<span><span class="co">#&gt; AIC= -100.941</span></span>
<span><span class="co">#&gt; Fitting half-normal key function</span></span>
<span><span class="co">#&gt; AIC= -100.051</span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ Best model prediction ‚îÄ‚îÄ</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Fitting half-normal key function</span></span>
<span><span class="co">#&gt; AIC= -100.941</span></span>
<span><span class="co">#&gt; ESW values estimated, please check units.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ Update Effort Table ‚îÄ‚îÄ</span></span>
<span><span class="co">#&gt; </span></span>
<span></span>
<span></span>
<span><span class="va">export_esw</span><span class="op">$</span><span class="va">plot_esw</span></span></code></pre></div>
<p><img src="reference/figures/README-esw_Caculation-1.png" width="100%"></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">export_esw</span><span class="op">$</span><span class="va">data_esw</span></span>
<span><span class="co">#&gt;              plateform      mean         sd       Q_25      Q_97</span></span>
<span><span class="co">#&gt; 1        bridge_inside 0.1576222 0.10555443 0.02992728 0.4298707</span></span>
<span><span class="co">#&gt; 2 upper_bridge_outside 0.4459053 0.04351167 0.34914654 0.5149732</span></span>
<span></span>
<span><span class="va">export_esw</span><span class="op">$</span><span class="va">model_selection</span></span>
<span><span class="co">#&gt;                      model        AIC det_fun</span></span>
<span><span class="co">#&gt; 1            1 + plateform -100.94053      hn</span></span>
<span><span class="co">#&gt; 2             1 + Beaufort -100.05119      hn</span></span>
<span><span class="co">#&gt; 3 1 + Beaufort + plateform  -99.78064      hn</span></span>
<span></span>
<span><span class="va">export_esw</span><span class="op">$</span><span class="va">effort_output</span></span>
<span><span class="co">#&gt; Simple feature collection with 390 features and 16 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -5.657199 ymin: 43.66589 xmax: -1.253505 ymax: 48.31222</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt; # A tibble: 390 √ó 17</span></span>
<span><span class="co">#&gt;    Beaufort TransectID         plateform         n_obs LegID Start_time         </span></span>
<span><span class="co">#&gt;       &lt;dbl&gt; &lt;chr&gt;              &lt;chr&gt;             &lt;dbl&gt; &lt;chr&gt; &lt;dttm&gt;             </span></span>
<span><span class="co">#&gt;  1        0 TR_Pelgas_25052023 upper_bridge_out‚Ä¶     2 2505‚Ä¶ 2023-05-25 04:57:07</span></span>
<span><span class="co">#&gt;  2        1 TR_Pelgas_04052023 upper_bridge_out‚Ä¶     2 0405‚Ä¶ 2023-05-04 11:42:53</span></span>
<span><span class="co">#&gt;  3        1 TR_Pelgas_05052023 upper_bridge_out‚Ä¶     2 0505‚Ä¶ 2023-05-05 13:56:44</span></span>
<span><span class="co">#&gt;  4        1 TR_Pelgas_05052023 upper_bridge_out‚Ä¶     2 0505‚Ä¶ 2023-05-05 13:56:44</span></span>
<span><span class="co">#&gt;  5        1 TR_Pelgas_05052023 upper_bridge_out‚Ä¶     2 0505‚Ä¶ 2023-05-05 13:56:44</span></span>
<span><span class="co">#&gt;  6        1 TR_Pelgas_05052023 upper_bridge_out‚Ä¶     2 0505‚Ä¶ 2023-05-05 13:56:44</span></span>
<span><span class="co">#&gt;  7        1 TR_Pelgas_05052023 upper_bridge_out‚Ä¶     2 0505‚Ä¶ 2023-05-05 16:09:17</span></span>
<span><span class="co">#&gt;  8        1 TR_Pelgas_18052023 upper_bridge_out‚Ä¶     2 1805‚Ä¶ 2023-05-18 11:33:05</span></span>
<span><span class="co">#&gt;  9        1 TR_Pelgas_22052023 upper_bridge_out‚Ä¶     2 2205‚Ä¶ 2023-05-22 15:03:10</span></span>
<span><span class="co">#&gt; 10        1 TR_Pelgas_27052023 upper_bridge_out‚Ä¶     2 2705‚Ä¶ 2023-05-27 13:24:10</span></span>
<span><span class="co">#&gt; # ‚Ñπ 380 more rows</span></span>
<span><span class="co">#&gt; # ‚Ñπ 11 more variables: DateTime &lt;dttm&gt;, End_time &lt;dttm&gt;, SegID &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   Effort &lt;dbl&gt;, geometry &lt;POINT [¬∞]&gt;, det.FULGLA &lt;dbl&gt;, ind.FULGLA &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   mean_esw_FULGLA &lt;dbl&gt;, sd_esw_FULGLA &lt;dbl&gt;, Q25_esw_FULGLA &lt;dbl&gt;,</span></span>
<span><span class="co">#&gt; #   Q75_esw_FULGLA &lt;dbl&gt;</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="soap-smooth">Soap smooth<a class="anchor" aria-label="anchor" href="#soap-smooth"></a>
</h2>
<p>GAM with ‚Äòmgcv‚Äô can be done using soap smooth to take into account for border effect. The function ‚Äòmake_soap‚Äô can do it.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">soap_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/make_soap.html">make_soap</a></span><span class="op">(</span><span class="va">export_esw</span><span class="op">$</span><span class="va">effort_output</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-create_soap-1.png" width="100%"></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">soap_data</span><span class="op">$</span><span class="va">bound</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [[1]]$lon</span></span>
<span><span class="co">#&gt;  [1] -1.484863 -1.345996 -1.245508 -1.170801 -1.118787 -1.113344 -1.152881</span></span>
<span><span class="co">#&gt;  [8] -1.200391 -1.220312 -1.245215 -1.189062 -1.149072 -1.081006 -1.049483</span></span>
<span><span class="co">#&gt; [15] -1.065157 -1.169971 -1.195996 -1.209961 -1.114355 -1.081974 -1.137902</span></span>
<span><span class="co">#&gt; [22] -1.347234 -1.392480 -1.786523 -1.921436 -2.059375 -2.092480 -2.090372</span></span>
<span><span class="co">#&gt; [29] -3.003076 -3.064209 -3.158838 -3.221582 -3.264697 -3.328613 -3.395898</span></span>
<span><span class="co">#&gt; [36] -3.443945 -3.507813 -3.900928 -4.070703 -4.226416 -4.312109 -4.375098</span></span>
<span><span class="co">#&gt; [43] -4.427979 -4.678809 -4.629199 -4.512402 -4.377832 -4.329443 -4.434619</span></span>
<span><span class="co">#&gt; [50] -4.512207 -4.544336 -4.577148 -4.530664 -4.497900 -4.403320 -4.295179</span></span>
<span><span class="co">#&gt; [57] -4.429015 -4.524805 -4.584717 -4.719385 -4.748535 -4.762500 -4.761131</span></span>
<span><span class="co">#&gt; [64] -4.792350 -5.257865 -5.894158 -5.553697 -4.192340 -3.137817 -3.097702</span></span>
<span><span class="co">#&gt; [71] -1.499917 -1.484863 -1.178320 -1.213574 -1.280273 -1.368701 -1.388867</span></span>
<span><span class="co">#&gt; [78] -1.388672 -1.285059 -1.178320</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[1]]$lat</span></span>
<span><span class="co">#&gt;  [1] 43.56377 44.02021 44.55986 44.66182 44.67736 44.72542 44.76401 44.72646</span></span>
<span><span class="co">#&gt;  [9] 44.68662 44.66670 45.16147 45.34263 45.53242 45.51540 45.63258 45.68594</span></span>
<span><span class="co">#&gt; [17] 45.71445 45.77090 45.76851 45.75776 46.17004 46.33694 46.35010 46.51484</span></span>
<span><span class="co">#&gt; [25] 46.68481 46.81030 46.86504 46.91828 47.60898 47.62134 47.69468 47.69414</span></span>
<span><span class="co">#&gt; [33] 47.68511 47.71333 47.72041 47.71104 47.75312 47.83755 47.84785 47.80962</span></span>
<span><span class="co">#&gt; [41] 47.82290 47.87744 47.96895 48.03950 48.08579 48.09673 48.12881 48.16997</span></span>
<span><span class="co">#&gt; [49] 48.21797 48.22974 48.24697 48.29004 48.30972 48.29927 48.29307 48.30017</span></span>
<span><span class="co">#&gt; [57] 48.36892 48.37231 48.35752 48.36313 48.41001 48.45024 48.45319 48.45917</span></span>
<span><span class="co">#&gt; [65] 48.43885 47.18012 46.61329 44.88593 43.55620 43.51886 43.55089 43.56377</span></span>
<span><span class="co">#&gt; [73] 45.90405 45.81660 45.89712 45.96768 46.03296 46.05039 46.00269 45.90405</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">soap_data</span><span class="op">$</span><span class="va">knots</span><span class="op">)</span></span>
<span><span class="co">#&gt;          lon      lat</span></span>
<span><span class="co">#&gt; 37 -3.031395 43.74342</span></span>
<span><span class="co">#&gt; 38 -2.811183 43.74342</span></span>
<span><span class="co">#&gt; 39 -2.590970 43.74342</span></span>
<span><span class="co">#&gt; 40 -2.370758 43.74342</span></span>
<span><span class="co">#&gt; 41 -2.150545 43.74342</span></span>
<span><span class="co">#&gt; 42 -1.930333 43.74342</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="calculation">Calculation<a class="anchor" aria-label="anchor" href="#calculation"></a>
</h2>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="reference/fit_and_predict.html">fit_and_predict</a></span><span class="op">(</span>effort_table <span class="op">=</span> <span class="va">export_esw</span><span class="op">$</span><span class="va">effort_output</span>, </span>
<span>                response_y <span class="op">=</span> <span class="st">"ind.FULGLA"</span>, </span>
<span>                family <span class="op">=</span> <span class="st">"nb"</span>, </span>
<span>                knots <span class="op">=</span> <span class="va">soap_data</span><span class="op">$</span><span class="va">knots</span>, </span>
<span>                bound <span class="op">=</span> <span class="va">soap_data</span><span class="op">$</span><span class="va">bound</span>, </span>
<span>                species <span class="op">=</span> <span class="st">"FULGLA"</span>, </span>
<span>                prediction_grid <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>                covariates_x <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>                save <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ Start fitting ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ Create predict table ‚îÄ‚îÄ</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Predict table is created based on effort table.</span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ Fitting gam ‚îÄ‚îÄ</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Family: Negative Binomial(0.54) </span></span>
<span><span class="co">#&gt; Link function: log </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula:</span></span>
<span><span class="co">#&gt; get(response_y) ~ 1 + s(lon, lat, bs = "so", xt = list(bnd = bound))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimated degrees of freedom:</span></span>
<span><span class="co">#&gt; 9.68  total = 10.68 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; REML score: 201.8988</span></span>
<span><span class="co">#&gt; ‚îÄ‚îÄ Make prediction ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span></span>
<span><span class="co">#&gt; FULGLA has a mean density at 0.035 with min= 0 and max= 0.158.</span></span>
<span><span class="co">#&gt; $model_data</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Family: Negative Binomial(0.54) </span></span>
<span><span class="co">#&gt; Link function: log </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula:</span></span>
<span><span class="co">#&gt; get(response_y) ~ 1 + s(lon, lat, bs = "so", xt = list(bnd = bound))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimated degrees of freedom:</span></span>
<span><span class="co">#&gt; 9.68  total = 10.68 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; REML score: 201.8988     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $output_map</span></span></code></pre></div>
<p><img src="reference/figures/README-calculation-1.png" width="100%"></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a><span class="co">#&gt; $prediction_map</span></span></code></pre></div>
<p><img src="reference/figures/README-calculation-2.png" width="100%"></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a><span class="co">#&gt; $data_predict</span></span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 2472 features and 3 fields</span></span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span id="cb32-5"><a href="#cb32-5" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb32-6"><a href="#cb32-6" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -5.894158 ymin: 43.53386 xmax: -1.043256 ymax: 48.45917</span></span>
<span id="cb32-7"><a href="#cb32-7" tabindex="-1"></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb32-8"><a href="#cb32-8" tabindex="-1"></a><span class="co">#&gt; First 10 features:</span></span>
<span id="cb32-9"><a href="#cb32-9" tabindex="-1"></a><span class="co">#&gt;       Density         SE Species                       geometry</span></span>
<span id="cb32-10"><a href="#cb32-10" tabindex="-1"></a><span class="co">#&gt; 2  0.04883522 0.02804986  FULGLA POLYGON ((-5.265338 48.4591...</span></span>
<span id="cb32-11"><a href="#cb32-11" tabindex="-1"></a><span class="co">#&gt; 3  0.04625478 0.02656228  FULGLA POLYGON ((-5.175506 48.4591...</span></span>
<span id="cb32-12"><a href="#cb32-12" tabindex="-1"></a><span class="co">#&gt; 4  0.04357924 0.02456320  FULGLA POLYGON ((-5.085675 48.4591...</span></span>
<span id="cb32-13"><a href="#cb32-13" tabindex="-1"></a><span class="co">#&gt; 5  0.04106622 0.02293252  FULGLA POLYGON ((-4.995843 48.4591...</span></span>
<span id="cb32-14"><a href="#cb32-14" tabindex="-1"></a><span class="co">#&gt; 6  0.03883960 0.02174332  FULGLA POLYGON ((-4.906011 48.4591...</span></span>
<span id="cb32-15"><a href="#cb32-15" tabindex="-1"></a><span class="co">#&gt; 7  0.03705187 0.02112480  FULGLA POLYGON ((-4.81618 48.45917...</span></span>
<span id="cb32-16"><a href="#cb32-16" tabindex="-1"></a><span class="co">#&gt; 9  0.04933411 0.02735214  FULGLA POLYGON ((-5.265338 48.3995...</span></span>
<span id="cb32-17"><a href="#cb32-17" tabindex="-1"></a><span class="co">#&gt; 10 0.04597774 0.02489122  FULGLA POLYGON ((-5.175506 48.3995...</span></span>
<span id="cb32-18"><a href="#cb32-18" tabindex="-1"></a><span class="co">#&gt; 11 0.04282812 0.02280001  FULGLA POLYGON ((-5.085675 48.3995...</span></span>
<span id="cb32-19"><a href="#cb32-19" tabindex="-1"></a><span class="co">#&gt; 12 0.03993427 0.02103133  FULGLA POLYGON ((-4.995843 48.3995...</span></span>
<span id="cb32-20"><a href="#cb32-20" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb32-21"><a href="#cb32-21" tabindex="-1"></a><span class="co">#&gt; $data_fit</span></span>
<span id="cb32-22"><a href="#cb32-22" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 390 features and 18 fields</span></span>
<span id="cb32-23"><a href="#cb32-23" tabindex="-1"></a><span class="co">#&gt; Geometry type: POINT</span></span>
<span id="cb32-24"><a href="#cb32-24" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb32-25"><a href="#cb32-25" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -5.657199 ymin: 43.66589 xmax: -1.253505 ymax: 48.31222</span></span>
<span id="cb32-26"><a href="#cb32-26" tabindex="-1"></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb32-27"><a href="#cb32-27" tabindex="-1"></a><span class="co">#&gt; # A tibble: 390 √ó 19</span></span>
<span id="cb32-28"><a href="#cb32-28" tabindex="-1"></a><span class="co">#&gt;    Beaufort TransectID         plateform         n_obs LegID Start_time         </span></span>
<span id="cb32-29"><a href="#cb32-29" tabindex="-1"></a><span class="co">#&gt;       &lt;dbl&gt; &lt;chr&gt;              &lt;chr&gt;             &lt;dbl&gt; &lt;chr&gt; &lt;dttm&gt;             </span></span>
<span id="cb32-30"><a href="#cb32-30" tabindex="-1"></a><span class="co">#&gt;  1        0 TR_Pelgas_25052023 upper_bridge_out‚Ä¶     2 2505‚Ä¶ 2023-05-25 04:57:07</span></span>
<span id="cb32-31"><a href="#cb32-31" tabindex="-1"></a><span class="co">#&gt;  2        1 TR_Pelgas_04052023 upper_bridge_out‚Ä¶     2 0405‚Ä¶ 2023-05-04 11:42:53</span></span>
<span id="cb32-32"><a href="#cb32-32" tabindex="-1"></a><span class="co">#&gt;  3        1 TR_Pelgas_05052023 upper_bridge_out‚Ä¶     2 0505‚Ä¶ 2023-05-05 13:56:44</span></span>
<span id="cb32-33"><a href="#cb32-33" tabindex="-1"></a><span class="co">#&gt;  4        1 TR_Pelgas_05052023 upper_bridge_out‚Ä¶     2 0505‚Ä¶ 2023-05-05 13:56:44</span></span>
<span id="cb32-34"><a href="#cb32-34" tabindex="-1"></a><span class="co">#&gt;  5        1 TR_Pelgas_05052023 upper_bridge_out‚Ä¶     2 0505‚Ä¶ 2023-05-05 13:56:44</span></span>
<span id="cb32-35"><a href="#cb32-35" tabindex="-1"></a><span class="co">#&gt;  6        1 TR_Pelgas_05052023 upper_bridge_out‚Ä¶     2 0505‚Ä¶ 2023-05-05 13:56:44</span></span>
<span id="cb32-36"><a href="#cb32-36" tabindex="-1"></a><span class="co">#&gt;  7        1 TR_Pelgas_05052023 upper_bridge_out‚Ä¶     2 0505‚Ä¶ 2023-05-05 16:09:17</span></span>
<span id="cb32-37"><a href="#cb32-37" tabindex="-1"></a><span class="co">#&gt;  8        1 TR_Pelgas_18052023 upper_bridge_out‚Ä¶     2 1805‚Ä¶ 2023-05-18 11:33:05</span></span>
<span id="cb32-38"><a href="#cb32-38" tabindex="-1"></a><span class="co">#&gt;  9        1 TR_Pelgas_22052023 upper_bridge_out‚Ä¶     2 2205‚Ä¶ 2023-05-22 15:03:10</span></span>
<span id="cb32-39"><a href="#cb32-39" tabindex="-1"></a><span class="co">#&gt; 10        1 TR_Pelgas_27052023 upper_bridge_out‚Ä¶     2 2705‚Ä¶ 2023-05-27 13:24:10</span></span>
<span id="cb32-40"><a href="#cb32-40" tabindex="-1"></a><span class="co">#&gt; # ‚Ñπ 380 more rows</span></span>
<span id="cb32-41"><a href="#cb32-41" tabindex="-1"></a><span class="co">#&gt; # ‚Ñπ 13 more variables: DateTime &lt;dttm&gt;, End_time &lt;dttm&gt;, SegID &lt;chr&gt;,</span></span>
<span id="cb32-42"><a href="#cb32-42" tabindex="-1"></a><span class="co">#&gt; #   Effort &lt;dbl&gt;, geometry &lt;POINT [¬∞]&gt;, det.FULGLA &lt;dbl&gt;, ind.FULGLA &lt;dbl&gt;,</span></span>
<span id="cb32-43"><a href="#cb32-43" tabindex="-1"></a><span class="co">#&gt; #   mean_esw_FULGLA &lt;dbl&gt;, sd_esw_FULGLA &lt;dbl&gt;, Q25_esw_FULGLA &lt;dbl&gt;,</span></span>
<span id="cb32-44"><a href="#cb32-44" tabindex="-1"></a><span class="co">#&gt; #   Q75_esw_FULGLA &lt;dbl&gt;, lon &lt;dbl&gt;, lat &lt;dbl&gt;</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>

<div class="community">
<h2 data-toc-skip>Community</h2>
<ul class="list-unstyled">
<li><a href="CODE_OF_CONDUCT.html">Code of conduct</a></li>
</ul>
</div>

<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing pelascope</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Guillaume Chero <br><small class="roles"> Author, maintainer </small>   </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Guillaume Chero.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
